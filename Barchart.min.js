var graphHeight,graphWidth,Id;var widthOfRect,toolTipYPosition,chartColor=[];class BarChart{constructor(input){this.id=input.id;this.height=input.height||200;this.width=input.width||300;this.data=input.data;this.chartColor=input.chartColor||"blue";this.margin={"Left":40,"Right":20,"Top":20,"Bottom":20};if(input.margin!=undefined){this.margin.Left=input.margin.Left||20;this.margin.Right=input.margin.Right||20;this.margin.Top=input.margin.Top||20;this.margin.Bottom=input.margin.Bottom||20}
this.animationDelay=input.animationDelay||500;this.toolTipYPosition=input.toolTipYPosition||40;this.yAxisTicks=input.yAxisTicks||5}
createBarChart()
{Id=this.id;graphHeight=this.height-this.margin.Top-this.margin.Bottom;graphWidth=this.width-this.margin.Left-this.margin.Right;toolTipYPosition=this.toolTipYPosition;chartColor=this.chartColor;var svg=d3.select('#'+this.id).append('svg').attr('height',this.height).attr('width',this.width);var g=svg.append('g').attr('transform','translate('+this.margin.Left+','+this.margin.Top+')');var xscale=d3.scaleBand().rangeRound([0,graphWidth]).padding(0.1),yscale=d3.scaleLinear().rangeRound([graphHeight,0]);var xAxisValues=[],yAxisValues=[];for(var i=0;i<data.length;i++){xAxisValues[i]=data[i].xAxisValue;yAxisValues[i]=data[i].yAxisValue}
xscale.domain(xAxisValues);yscale.domain([0,d3.max(yAxisValues)]);g.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+graphHeight+")").call(d3.axisBottom(xscale));g.append("g").attr("class","axis axis--y").call(d3.axisLeft(yscale).ticks(yAxisTicks));var divDetails=d3.select("#"+Id).append("div").attr("class","details").style("opacity",0);g.selectAll('.bar').data(data).enter().append("rect").attr("class","bar").attr("fill",function(d,i){if(chartColor!=undefined&&chartColor[i]!=null){return chartColor[i]}
else{return chartColor}}).attr("x",function(d){return(xscale(d.xAxisValue))}).attr("y",graphHeight).attr("width",xscale.bandwidth()).attr("height",0).transition().duration(this.animationDelay).delay(function(d,i){return i*50}).attr("y",function(d){return(yscale(d.yAxisValue))}).attr("height",function(d){return graphHeight-yscale(d.yAxisValue)});d3.selectAll(".bar").on("mouseover",function(d){divDetails.transition().duration(200).style("opacity",1);divDetails.html(d.xAxisValue+"<br/>"+d.yAxisValue);divDetails.style("left",(xscale(d.xAxisValue)+margin.Left)+"px").style("margin-top",(-svg.attr('height')-$('.details').outerHeight()+yscale(d.yAxisValue)+margin.Top-12)+"px");d3.select(this).attr("opacity",0.8)}).on("mouseout",function(d){divDetails.transition().duration(500).style("opacity",0);d3.select(this).attr("opacity",1)});var axisLines=d3.selectAll(".axis--y .tick line").attr("x2",graphWidth);widthOfRect=d3.select('.bar').attr('width');var div=d3.select("#"+Id).append("div").attr("class","tooltip").style("opacity",0);var axistext=d3.selectAll(".axis--x .tick text").each(function(d,i){d3.select(this).text(dotmeXaxis(d3.select(this),data[i].xAxisValue));d3.select(this).on("mouseover",function(d){div.transition().duration(200).style("opacity",1);div.html(data[i].xAxisValue).style("left",(d3.event.pageX)+"px").style("top",(d3.event.pageY-toolTipYPosition)+"px")}).on("mouseout",function(d){div.transition().duration(500).style("opacity",0)})})}}
function dotmeXaxis(d3Node,text){var tempText=text;if(d3Node.node().getComputedTextLength()>widthOfRect){tempText=text+"...";d3Node.text(tempText);while(d3Node.node().getComputedTextLength()>widthOfRect){tempText=tempText.slice(0,tempText.length-4)+tempText.slice(tempText.length-3,tempText.length);d3Node.text(tempText)}}
return tempText}